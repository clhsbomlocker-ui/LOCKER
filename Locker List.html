<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Locker List</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family:'Segoe UI',sans-serif; background:#f1f3f4; padding:30px; }
  h1 { text-align:center; color:#1a73e8; }
  .box { background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
  .controls { display:flex; gap:10px; margin-bottom:12px; flex-wrap:wrap; }
  input, select { padding:10px; border:1px solid #ccc; border-radius:6px; }
  table { width:100%; border-collapse:collapse; background:white; border-radius:8px; overflow:hidden; }
  th, td { padding:12px 15px; border-bottom:1px solid #ddd; text-align:left; }
  th { background:#1a73e8; color:#fff; }
</style>
</head>
<body>
<h1>Locker List</h1>
<div class="box">
  <div class="controls">
    <input id="q" placeholder="Search name/class/school no./locker no.">
    <select id="rowFilter">
      <option value="">All Rows</option>
      <option value="1">Row 1 (1001…)</option>
      <option value="2">Row 2 (1002…)</option>
      <option value="3">Row 3 (1003…)</option>
      <option value="4">Row 4 (1004…)</option>
      <option value="5">Row 5 (1005…)</option>
      <option value="6">Row 6 (1006…)</option>
    </select>
  </div>
  <table id="tbl">
    <thead>
      <tr>
        <th>Name (EN)</th>
        <th>Name (CN)</th>
        <th>Class</th>
        <th>School No.</th>
        <th>Contact</th>
        <th>Email</th>
        <th>Locker No.</th>
        <th>Row</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
  const KEY_LOCKER_LIST = 'lockerList';

  function rowOf(locker){
    const n = Number(locker);
    if (!n) return null;
    return ((n - 1001) % 6 + 1);
  }

  function load(){
    const q = (document.getElementById("q").value || "").toLowerCase();
    const rf = document.getElementById("rowFilter").value;
    const regs = JSON.parse(localStorage.getItem(KEY_LOCKER_LIST)) || [];
    const tbody = document.querySelector("#tbl tbody");
    tbody.innerHTML = "";

    regs
      .filter(r => r.locker_number)
      .filter(r => {
        const fields = [r.name_en, r.name_cn, r.class, r.school_no, String(r.locker_number)];
        const matchQ = !q || fields.some(x => (String(x||"")).toLowerCase().includes(q));
        const matchRow = !rf || String(rowOf(r.locker_number)) === rf;
        return matchQ && matchRow;
      })
      .forEach(r => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${r.name_en||"-"}</td>
          <td>${r.name_cn||"-"}</td>
          <td>${r.class||"-"}</td>
          <td>${(r.school_no||"").toUpperCase()}</td>
          <td>${r.contact||"-"}</td>
          <td>${r.email||"-"}</td>
          <td>${r.locker_number||"-"}</td>
          <td>${rowOf(r.locker_number)||"-"}</td>`;
        tbody.appendChild(tr);
      });
  }

  document.getElementById("q").addEventListener("input", load);
  document.getElementById("rowFilter").addEventListener("change", load);
  load();
</script>
</body>
</html>
